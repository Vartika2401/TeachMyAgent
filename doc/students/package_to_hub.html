<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>TeachMyAgent.students.package_to_hub API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
<link rel="icon" href="https://github.com/flowersteam/TeachMyAgent/blob/gh-pages/images/favicon-96x96.png?raw=true" />
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>TeachMyAgent.students.package_to_hub</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">from huggingface_hub import HfApi, upload_folder
from huggingface_hub.repocard import metadata_eval_result, metadata_save
import tempfile
from pathlib import Path
import subprocess
import json

def package_to_hub(repo_id,
                   ta_config,
                   model_path,
                   mean_reward,
                   std_reward,
                   hyperparameters,
                   token=None
                   ):
    # # Step 1: Clone or create the repo
    repo_url = HfApi().create_repo(
        repo_id=repo_id,
        repo_type=&#34;model&#34;,
        token=token,
        private=False,
        exist_ok=True,
    )

    with tempfile.TemporaryDirectory() as tmpdirname:
        tmpdirname = Path(tmpdirname)

        # Step 2: Save the tfjs model
        subprocess.run(&#39;tensorflowjs_converter --input_format=tf_saved_model --output_node_names=&#34;parkour_walker&#34; &#39; +
                       f&#39;--saved_model_tags=serve --skip_op_check {model_path}/tf1_save {tmpdirname}&#39;,
                       shell=True, check=True)

        # Step 3: Write TeachMyAgent&#39;s config fle
        with open(tmpdirname / &#34;ta-config.json&#34;, &#34;w&#34;) as outfile:
            json.dump(ta_config, outfile)

        # Step 5: Generate the model card
        generated_model_card, metadata = _generate_model_card(ta_config[&#34;name&#34;], mean_reward, std_reward, hyperparameters)
        _save_model_card(tmpdirname, generated_model_card, metadata)

        repo_url = upload_folder(
            repo_id=repo_id,
            folder_path=tmpdirname,
            path_in_repo=&#34;&#34;,
            commit_message=f&#34;Uploading {repo_id}&#34;,
            token=token,
        )

    return repo_url

def _generate_model_card(model_name, mean_reward, std_reward, hyperparameters):
    &#34;&#34;&#34;
    Generate the model card for the Hub
    :param model_name: name of the model
    :mean_reward: mean reward of the agent
    :std_reward: standard deviation of the mean reward of the agent
    :hyperparameters: training arguments
    &#34;&#34;&#34;
    # Step 1: Select the tags
    metadata = generate_metadata(model_name, mean_reward, std_reward)

    # Transform the hyperparams namespace to string
    # converted_dict = vars(hyperparameters)
    converted_str = str(hyperparameters)
    converted_str = converted_str.split(&#34;, &#34;)
    converted_str = &#39;\n&#39;.join(converted_str)

    # Step 2: Generate the model card
    model_card = f&#34;&#34;&#34;
  # Deep RL Agent Playing TeachMyAgent&#39;s parkour.
  You can find more info about TeachMyAgent [here](https://developmentalsystems.org/TeachMyAgent/).
  
  Results of our benchmark can be found in our [paper](https://arxiv.org/pdf/2103.09815.pdf).
  
  You can test this policy [here](https://huggingface.co/spaces/flowers-team/Interactive_DeepRL_Demo)
  
  ## Results
  Percentage of mastered tasks (i.e. reward &gt;= 230) after 20 millions steps on the Parkour track. 
  
  Results shown are averages over 16 seeds along with the standard deviation for each morphology as well as the aggregation of the 48 seeds in the *Overall* column. 
  
  We highlight the best results in bold.
  
  | Algorithm     | BipedalWalker  | Fish          | Climber      | Overall       |
  |---------------|----------------|---------------|--------------|---------------|
  | Random        | 27.25 (± 10.7) | 23.6 (± 21.3) | 0.0 (± 0.0)  | 16.9 (± 18.3) |
  | ADR           | 14.7 (± 19.4)  | 5.3 (± 20.6)  | 0.0 (± 0.0)  | 6.7 (± 17.4)  |
  | ALP-GMM       | **42.7** (± 11.2)  | 36.1 (± 28.5) | 0.4 (± 1.2)  | **26.4** (± 25.7) |
  | Covar-GMM     | 35.7 (± 15.9)  | 29.9 (± 27.9) | 0.5 (± 1.9)  | 22.1 (± 24.2) |
  | GoalGAN       | 25.4 (± 24.7)  | 34.7 ± 37.0)  | 0.8 (± 2.7)  | 20.3 (± 29.5) |
  | RIAC          | 31.2 (± 8.2)   | **37.4** (± 25.4) | 0.4  (± 1.4) | 23.0 (± 22.4) |
  | SPDL          | 30.6 (± 22.8)  | 9.0 (± 24.2)  | **1.0** (± 3.4)  | 13.5 (± 23.0) |
  | Setter-Solver | 28.75 (± 20.7) | 5.1 (± 7.6)   | 0.0 (± 0.0)  | 11.3 (± 17.9) |

  # Hyperparameters
  ```python
  {converted_str}
  ```
  &#34;&#34;&#34;
    return model_card, metadata


def generate_metadata(model_name, mean_reward, std_reward):
    &#34;&#34;&#34;
    Define the tags for the model card
    :param model_name: name of the model
    :mean_reward: mean reward of the agent
    :std_reward: standard deviation of the mean reward of the agent
    &#34;&#34;&#34;
    metadata = {}
    metadata[&#34;tags&#34;] = [
        &#34;sac&#34;,
        &#34;deep-reinforcement-learning&#34;,
        &#34;reinforcement-learning&#34;,
        &#34;teach-my-agent-parkour&#34;
    ]

    # Add metrics
    eval = metadata_eval_result(
        model_pretty_name=model_name,
        task_pretty_name=&#34;reinforcement-learning&#34;,
        task_id=&#34;reinforcement-learning&#34;,
        metrics_pretty_name=&#34;mean_reward&#34;,
        metrics_id=&#34;mean_reward&#34;,
        metrics_value=f&#34;{mean_reward:.2f} +/- {std_reward:.2f}&#34;,
        dataset_pretty_name=&#34;teach-my-agent-parkour&#34;,
        dataset_id=&#34;teach-my-agent-parkour&#34;
    )

    # Merges both dictionaries
    metadata = {**metadata, **eval}

    return metadata


def _save_model_card(local_path, generated_model_card, metadata):
    &#34;&#34;&#34;Saves a model card for the repository.
    :param local_path: repository directory
    :param generated_model_card: model card generated by _generate_model_card()
    :param metadata: metadata
    &#34;&#34;&#34;
    readme_path = local_path / &#34;README.md&#34;
    readme = &#34;&#34;
    if readme_path.exists():
        with readme_path.open(&#34;r&#34;, encoding=&#34;utf8&#34;) as f:
            readme = f.read()
    else:
        readme = generated_model_card

    with readme_path.open(&#34;w&#34;, encoding=&#34;utf-8&#34;) as f:
        f.write(readme)

    # Save our metrics to Readme metadata
    metadata_save(readme_path, metadata)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="TeachMyAgent.students.package_to_hub.generate_metadata"><code class="name flex">
<span>def <span class="ident">generate_metadata</span></span>(<span>model_name, mean_reward, std_reward)</span>
</code></dt>
<dd>
<div class="desc"><p>Define the tags for the model card
:param model_name: name of the model
:mean_reward: mean reward of the agent
:std_reward: standard deviation of the mean reward of the agent</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def generate_metadata(model_name, mean_reward, std_reward):
    &#34;&#34;&#34;
    Define the tags for the model card
    :param model_name: name of the model
    :mean_reward: mean reward of the agent
    :std_reward: standard deviation of the mean reward of the agent
    &#34;&#34;&#34;
    metadata = {}
    metadata[&#34;tags&#34;] = [
        &#34;sac&#34;,
        &#34;deep-reinforcement-learning&#34;,
        &#34;reinforcement-learning&#34;,
        &#34;teach-my-agent-parkour&#34;
    ]

    # Add metrics
    eval = metadata_eval_result(
        model_pretty_name=model_name,
        task_pretty_name=&#34;reinforcement-learning&#34;,
        task_id=&#34;reinforcement-learning&#34;,
        metrics_pretty_name=&#34;mean_reward&#34;,
        metrics_id=&#34;mean_reward&#34;,
        metrics_value=f&#34;{mean_reward:.2f} +/- {std_reward:.2f}&#34;,
        dataset_pretty_name=&#34;teach-my-agent-parkour&#34;,
        dataset_id=&#34;teach-my-agent-parkour&#34;
    )

    # Merges both dictionaries
    metadata = {**metadata, **eval}

    return metadata</code></pre>
</details>
</dd>
<dt id="TeachMyAgent.students.package_to_hub.package_to_hub"><code class="name flex">
<span>def <span class="ident">package_to_hub</span></span>(<span>repo_id, ta_config, model_path, mean_reward, std_reward, hyperparameters, token=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def package_to_hub(repo_id,
                   ta_config,
                   model_path,
                   mean_reward,
                   std_reward,
                   hyperparameters,
                   token=None
                   ):
    # # Step 1: Clone or create the repo
    repo_url = HfApi().create_repo(
        repo_id=repo_id,
        repo_type=&#34;model&#34;,
        token=token,
        private=False,
        exist_ok=True,
    )

    with tempfile.TemporaryDirectory() as tmpdirname:
        tmpdirname = Path(tmpdirname)

        # Step 2: Save the tfjs model
        subprocess.run(&#39;tensorflowjs_converter --input_format=tf_saved_model --output_node_names=&#34;parkour_walker&#34; &#39; +
                       f&#39;--saved_model_tags=serve --skip_op_check {model_path}/tf1_save {tmpdirname}&#39;,
                       shell=True, check=True)

        # Step 3: Write TeachMyAgent&#39;s config fle
        with open(tmpdirname / &#34;ta-config.json&#34;, &#34;w&#34;) as outfile:
            json.dump(ta_config, outfile)

        # Step 5: Generate the model card
        generated_model_card, metadata = _generate_model_card(ta_config[&#34;name&#34;], mean_reward, std_reward, hyperparameters)
        _save_model_card(tmpdirname, generated_model_card, metadata)

        repo_url = upload_folder(
            repo_id=repo_id,
            folder_path=tmpdirname,
            path_in_repo=&#34;&#34;,
            commit_message=f&#34;Uploading {repo_id}&#34;,
            token=token,
        )

    return repo_url</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<a href="http://developmentalsystems.org/TeachMyAgent/doc/">
<img src="https://github.com/flowersteam/TeachMyAgent/blob/gh-pages/images/home/head_image.png?raw=true" style="display: block; margin: 1em auto">
</a>
<a href="http://developmentalsystems.org/TeachMyAgent/doc/">Home</a> | <a href="http://developmentalsystems.org/TeachMyAgent/">Website</a>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="TeachMyAgent.students" href="index.html">TeachMyAgent.students</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="TeachMyAgent.students.package_to_hub.generate_metadata" href="#TeachMyAgent.students.package_to_hub.generate_metadata">generate_metadata</a></code></li>
<li><code><a title="TeachMyAgent.students.package_to_hub.package_to_hub" href="#TeachMyAgent.students.package_to_hub.package_to_hub">package_to_hub</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>